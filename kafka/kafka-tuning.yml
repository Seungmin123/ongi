version: "3.9"

services:
  kafka:
    environment:
      # --- KRaft 모드 기본 설정 ---
      KAFKA_ENABLE_KRAFT: "yes"
      KAFKA_CFG_NODE_ID: "1"
      KAFKA_CFG_PROCESS_ROLES: "broker,controller"
      KAFKA_CFG_CONTROLLER_LISTENER_NAMES: "CONTROLLER"
      KAFKA_CFG_LISTENERS: "PLAINTEXT://:9092,CONTROLLER://:9093"
      KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP: "PLAINTEXT:PLAINTEXT,CONTROLLER:PLAINTEXT"
      KAFKA_CFG_ADVERTISED_LISTENERS: "PLAINTEXT://kafka:9092"
      KAFKA_CFG_CONTROLLER_QUORUM_VOTERS: "1@kafka:9093"
      ALLOW_PLAINTEXT_LISTENER: "yes"   # 개발 환경에서만 사용 권장

      # --- 브로커 성능 튜닝 ---
      KAFKA_CFG_NUM_NETWORK_THREADS: "3"
      KAFKA_CFG_NUM_IO_THREADS: "8"
      KAFKA_CFG_BACKGROUND_THREADS: "4"

      # --- 소켓 버퍼 ---
      KAFKA_CFG_SOCKET_SEND_BUFFER_BYTES: "1048576"
      KAFKA_CFG_SOCKET_RECEIVE_BUFFER_BYTES: "1048576"

      # --- 로그/세그먼트 관리 ---
      KAFKA_CFG_LOG_SEGMENT_BYTES: "1073741824"
      KAFKA_CFG_LOG_RETENTION_HOURS: "72"
      KAFKA_CFG_LOG_RETENTION_CHECK_INTERVAL_MS: "300000"
      KAFKA_CFG_LOG_CLEANUP_POLICY: "delete"

      # --- 기본 토픽 설정 (개발용) ---
      KAFKA_CFG_AUTO_CREATE_TOPICS_ENABLE: "true"
      KAFKA_CFG_NUM_PARTITIONS: "3"
      KAFKA_CFG_DEFAULT_REPLICATION_FACTOR: "1"