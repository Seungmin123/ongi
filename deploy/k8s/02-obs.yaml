apiVersion: v1
kind: Namespace
metadata:
  name: ongi-obs
---
# -------------------------
# Mimir
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: mimir-config
  namespace: ongi-obs
data:
  config.yml: |
    multitenancy_enabled: false
    server:
      http_listen_port: 9009
    distributor:
      ring:
        kvstore:
          store: inmemory
    ingester:
      ring:
        kvstore:
          store: inmemory
        replication_factor: 1
    blocks_storage:
      backend: filesystem
      filesystem:
        dir: /data/tsdb
    compactor:
      data_dir: /data/compactor
      sharding_ring:
        kvstore:
          store: inmemory
    ruler:
      enable_api: true
      rule_path: /data/rules
    limits:
      ingestion_rate: 1000000
      ingestion_burst_size: 2000000
      max_global_series_per_user: 0
      max_global_series_per_metric: 0
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mimir-data
  namespace: ongi-obs
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 10Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mimir
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: mimir }
  template:
    metadata:
      labels: { app: mimir }
    spec:
      containers:
        - name: mimir
          image: grafana/mimir:latest
          args: ["-config.file=/etc/mimir/config.yml"]
          ports:
            - containerPort: 9009
          volumeMounts:
            - name: mimir-config
              mountPath: /etc/mimir/config.yml
              subPath: config.yml
            - name: mimir-data
              mountPath: /data
      volumes:
        - name: mimir-config
          configMap:
            name: mimir-config
        - name: mimir-data
          persistentVolumeClaim:
            claimName: mimir-data
---
apiVersion: v1
kind: Service
metadata:
  name: mimir
  namespace: ongi-obs
spec:
  selector: { app: mimir }
  ports:
    - name: http
      port: 9009
      targetPort: 9009
---
# -------------------------
# Loki
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-config
  namespace: ongi-obs
data:
  config.yml: |
    auth_enabled: false
    server:
      http_listen_port: 3100
      grpc_server_max_recv_msg_size: 104857600   # 100MB
      grpc_server_max_send_msg_size: 104857600
    common:
      path_prefix: /tmp/loki
      storage:
        filesystem:
          chunks_directory: /tmp/loki/chunks
          rules_directory: /tmp/loki/rules
      replication_factor: 1
      ring:
        instance_addr: 127.0.0.1
        kvstore:
          store: inmemory
    query_range:
      results_cache:
        cache:
          embedded_cache:
            enabled: true  # 결과 캐시 활성화 여부
            max_size_mb: 100  # 결과 캐시 최대 크기 (MB 단위)
    query_scheduler:
      max_outstanding_requests_per_tenant: 2048  # 테넌트 당 최대 대기 중인 요청 수
    schema_config:
      configs:
        - from: 2025-01-01
          store: tsdb
          object_store: filesystem
          schema: v13
          index:
            prefix: index_
            period: 24h
    limits_config:
      retention_period: 744h  # 보존 기간: 데이터 보존 기간
      ingestion_rate_mb: 50
      ingestion_burst_size_mb: 100
      max_line_size: 6291456
      split_queries_by_interval: 0  # 쿼리 구간별 분할: 쿼리 결과를 어떤 간격으로 분할할 지 여부
      allow_structured_metadata: true # log 메타 데이터 허용 여부
    compactor:
      working_directory: /tmp/loki/compactor
      delete_request_store: filesystem
      compaction_interval: 10m  # 컴팩션 간격: 컴팩션 실행 간격
      retention_enabled: true  # 보존 활성화 여부
      retention_delete_delay: 2h  # 보존 삭제 지연: 삭제 전 대기 기간
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: loki-data
  namespace: ongi-obs
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 10Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: loki
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: loki }
  template:
    metadata:
      labels: { app: loki }
    spec:
      containers:
        - name: loki
          image: grafana/loki:latest
          args: ["-config.file=/etc/loki/config.yml"]
          ports:
            - containerPort: 3100
          volumeMounts:
            - name: loki-config
              mountPath: /etc/loki/config.yml
              subPath: config.yml
            - name: loki-data
              mountPath: /tmp/loki
      volumes:
        - name: loki-config
          configMap:
            name: loki-config
        - name: loki-data
          persistentVolumeClaim:
            claimName: loki-data
---
apiVersion: v1
kind: Service
metadata:
  name: loki
  namespace: ongi-obs
spec:
  selector: { app: loki }
  ports:
    - name: http
      port: 3100
      targetPort: 3100
---
# -------------------------
# Tempo
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: tempo-config
  namespace: ongi-obs
data:
  tempo.yaml: |
    auth_enabled: false
    server:
      http_listen_port: 3200
    distributor:
      receivers:
        otlp:
          protocols:
            grpc:
              endpoint: 0.0.0.0:4317
            http:
              endpoint: 0.0.0.0:4318
    ingester:
      trace_idle_period: 10s
      max_block_duration: 5m
    compactor:
      compaction:
        block_retention: 24h
    storage:
      trace:
        backend: local
        local:
          path: /tmp/tempo
    query_frontend:
      max_outstanding_per_tenant: 2048
    metrics_generator:
      processor:
        service_graphs: {}
        span_metrics:
          dimensions: [http.method, http.target, http.status_code]
      storage:
        path: /tmp/tempo/metrics-generator

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: tempo-data
  namespace: ongi-obs
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 10Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: tempo
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: tempo }
  template:
    metadata:
      labels: { app: tempo }
    spec:
      containers:
        - name: tempo
          image: grafana/tempo:latest
          args: ["-config.file=/etc/tempo.yaml"]
          ports:
            - containerPort: 3200
            - containerPort: 4317
            - containerPort: 4318
          volumeMounts:
            - name: tempo-config
              mountPath: /etc/tempo.yaml
              subPath: tempo.yaml
            - name: tempo-data
              mountPath: /tmp/tempo
      volumes:
        - name: tempo-config
          configMap:
            name: tempo-config
        - name: tempo-data
          persistentVolumeClaim:
            claimName: tempo-data
---
apiVersion: v1
kind: Service
metadata:
  name: tempo
  namespace: ongi-obs
spec:
  selector: { app: tempo }
  ports:
    - name: http
      port: 3200
      targetPort: 3200
    - name: otlp-grpc
      port: 4317
      targetPort: 4317
    - name: otlp-http
      port: 4318
      targetPort: 4318
---
# -------------------------
# OTel Collector
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: otel-config
  namespace: ongi-obs
data:
  collector-config.yaml: |
    extensions:
      health_check:
      pprof:
    receivers:
      otlp:
        protocols:
          grpc:
            endpoint: "0.0.0.0:4317"
          http:
            endpoint: "0.0.0.0:4318"
    processors:
      memory_limiter:
        check_interval: 5s
        limit_percentage: 85
        spike_limit_percentage: 25
      batch:
        send_batch_size: 200
        timeout: 1s
      resource/sanitize_long_labels:
        attributes:
          - key: process.command_args
            action: delete
          - key: process.command_line
            action: delete
          - key: process.executable.path
            action: delete
          - key: process.command
            action: delete
      deltatocumulative: {}
      attributes/loki_hints:
        actions:
          - key: service_name
            from_attribute: service.name
            action: upsert
          # 리소스 라벨로 올릴 키들(스트림 라벨)
          - key: loki.resource.labels
            action: upsert
            value: service_name
          # 로그 레코드(라인) 라벨로 올릴 키들
          - key: loki.attribute.labels
            action: upsert
            value: http.method,http.target,log.severity_text,logger.name
          - key: loki.format
            action: upsert
            value: text  # API가 application/json이면 json, 아니라면 text
      transform/log_body_fix:
        error_mode: ignore
        log_statements:
          - context: log
            statements:
              # body가 비었으면 우선순위대로 채움(모두 문자열/JSON 문자열 가정)
              #- set(body, attributes["http.response.body"]) where body == nil and attributes["http.response.body"] != nil
              #- set(body, attributes["http.request.body"])  where body == nil and attributes["http.request.body"] != nil
              - set(body, attributes["message"])            where body == nil and attributes["message"] != nil
              - set(body, attributes["msg"])                where body == nil and attributes["msg"] != nil
              - set(body, attributes["log"])                where body == nil and attributes["log"] != nil
      transform/strip_huge_attrs:
        error_mode: ignore
        log_statements:
          - context: log
            statements:
              - delete_key(attributes, "http.request.body")
              - delete_key(attributes, "http.response.body")
              - delete_key(attributes, "request.body")
              - delete_key(attributes, "response.body")
      filter/drop:
        traces:
          span:
            - attributes["http.route"] == "/actuator/prometheus"
            - attributes["http.route"] == "/actuator/health"
      filter/drop_logs:
        logs:
          log_record:
            # exact match
            - 'attributes["http.target"] == "/actuator/prometheus"'
            - 'attributes["http.route"]  == "/actuator/prometheus"'
            - 'attributes["http.target"] == "/actuator/health"'
            - 'attributes["http.route"]  == "/actuator/health"'
            # 쿼리스트링 등 변형 포함(예: /actuator/prometheus?x=1)
            - 'attributes["http.target"] != nil and IsMatch(attributes["http.target"], "^/actuator/(prometheus|health)(\\?.*)?$")'
            - 'attributes["http.route"]  != nil and IsMatch(attributes["http.route"],  "^/actuator/(prometheus|health)(\\?.*)?$")'
            # 본문 문자열에만 경로가 찍히는 경우까지 커버
            - 'IsString(body) and IsMatch(body, "/actuator/(prometheus|health)")'
    exporters:
      otlp/tempo:
        endpoint: tempo:4317
        tls:
          insecure: true
        retry_on_failure:
          enabled: true
        sending_queue:
          enabled: true
          num_consumers: 2
          queue_size: 20480
      otlphttp/loki:
        endpoint: http://loki:3100/otlp
        compression: gzip
        # auth_enabled:true 환경이면 테넌트 지정
        # headers:
        #   X-Scope-OrgID: default
        retry_on_failure:
          enabled: true
          max_elapsed_time: 5m
        sending_queue:
          enabled: true
          num_consumers: 2
          queue_size: 10000
      prometheusremotewrite/mimir:
        endpoint: http://mimir:9009/api/v1/push
        resource_to_telemetry_conversion:
          enabled: true  # service.name 등 리소스 → 라벨 승격
    service:
      extensions: [ health_check, pprof ]
      telemetry:
        logs: { level: debug }  # 초기 확인용. 안정화 후 info로
      pipelines:
        metrics:
          receivers: [ otlp ]
          processors: [ resource/sanitize_long_labels, deltatocumulative, batch ]
          exporters: [ prometheusremotewrite/mimir ]
        traces:
          receivers: [ otlp ]
          processors: [ filter/drop, memory_limiter, batch ]
          exporters: [ otlp/tempo ]
        logs:
          receivers: [ otlp ]
          processors: [ memory_limiter, filter/drop_logs, attributes/loki_hints, transform/log_body_fix, batch ]
          exporters: [ otlphttp/loki ]
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: otel-collector
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: otel-collector }
  template:
    metadata:
      labels: { app: otel-collector }
    spec:
      containers:
        - name: otel-collector
          image: otel/opentelemetry-collector-contrib:0.131.0
          args: ["--config=/etc/otelcol/config.yaml"]
          ports:
            - containerPort: 4317
            - containerPort: 4318
          volumeMounts:
            - name: otel-config
              mountPath: /etc/otelcol/config.yaml
              subPath: collector-config.yaml
      volumes:
        - name: otel-config
          configMap:
            name: otel-config
---
apiVersion: v1
kind: Service
metadata:
  name: otel-collector
  namespace: ongi-obs
spec:
  selector: { app: otel-collector }
  ports:
    - name: otlp-grpc
      port: 4317
      targetPort: 4317
    - name: otlp-http
      port: 4318
      targetPort: 4318
---
# -------------------------
# Prometheus
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-config
  namespace: ongi-obs
data:
  prometheus.yml: |
    global:
      scrape_interval: 10s
    scrape_configs:
      - job_name: "redis-exporter"
        static_configs:
          - targets: ["redis-exporter.ongi-data.svc.cluster.local:9121"]
      - job_name: "kafka-exporter"
        static_configs:
          - targets: ["kafka-exporter.ongi-data.svc.cluster.local:9308"]
      - job_name: "kafka-jmx"
        static_configs:
          - targets: ["kafka.ongi-data.svc.cluster.local:9404"]
      # (선택) Spring Boot Actuator Prometheus endpoint
      # - job_name: "ongi-api"
      #   metrics_path: "/actuator/prometheus"
      #   static_configs:
      #     - targets: ["ongi-api.ongi.svc.cluster.local:8080"]
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: prometheus-data
  namespace: ongi-obs
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 5Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: prometheus }
  template:
    metadata:
      labels: { app: prometheus }
    spec:
      containers:
        - name: prometheus
          image: prom/prometheus:latest
          args:
            - "--config.file=/etc/prometheus/prometheus.yml"
            - "--storage.tsdb.retention.time=2d"
          ports:
            - containerPort: 9090
          volumeMounts:
            - name: prometheus-config
              mountPath: /etc/prometheus/prometheus.yml
              subPath: prometheus.yml
            - name: prometheus-data
              mountPath: /prometheus
      volumes:
        - name: prometheus-config
          configMap:
            name: prometheus-config
        - name: prometheus-data
          persistentVolumeClaim:
            claimName: prometheus-data
---
apiVersion: v1
kind: Service
metadata:
  name: prometheus
  namespace: ongi-obs
spec:
  selector: { app: prometheus }
  ports:
    - name: http
      port: 9090
      targetPort: 9090
---
# -------------------------
# Grafana
# -------------------------
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-datasources
  namespace: ongi-obs
data:
  datasources.yml: |
    apiVersion: 1
    datasources:
      - name: Loki
        type: loki
        uid: loki-ds
        access: proxy
        url: http://loki:3100
        isDefault: false
        jsonData:
          derivedFields:
            - name: trace_id
              matcherRegex: 'trace_id=(\w+)'
              url: '$${__value.raw}'
              datasourceUid: tempo-ds
      - name: Mimir
        type: prometheus
        uid: mimir-ds
        access: proxy
        url: http://mimir:9009/prometheus
        isDefault: true
      - name: Tempo
        type: tempo
        uid: tempo-ds
        access: proxy
        url: http://tempo:3200
        isDefault: false
        jsonData:
          tracesToLogsV2:
            datasourceUid: loki-ds
            spanStartTimeShift: '1h'
            spanEndTimeShift: '1h'
            filterByTraceID: true
            filterBySpanID: false
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-providers
  namespace: ongi-obs
data:
  dashboards.yaml: |
    apiVersion: 1
    providers:
      - name: 'template-dashboards'
        orgId: 1
        folder: 'Template'                 # Grafana 내 폴더명
        type: file
        disableDeletion: false
        allowUiUpdates: true
        updateIntervalSeconds: 10
        options:
          path: /var/lib/grafana/dashboards
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboards
  namespace: ongi-obs
data:
  template-dashboard.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": {
              "type": "datasource",
              "uid": "grafana"
            },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "target": {
              "limit": 100,
              "matchAny": false,
              "tags": [],
              "type": "dashboard"
            },
            "type": "dashboard"
          }
        ]
      },
      "description": "Spring Boot Dashboard adapted from https://grafana.com/grafana/dashboards/10280-microservices-spring-boot-2-1/",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": 2,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 0
          },
          "id": 54,
          "panels": [],
          "title": "Basic Statistics",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 1,
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 3,
            "w": 6,
            "x": 0,
            "y": 1
          },
          "id": 52,
          "maxDataPoints": 100,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "process_uptime_milliseconds{service_name=\"$service_name\", env=\"$env\"} / 1000",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "",
              "metric": "",
              "range": true,
              "refId": "A",
              "step": 14400
            }
          ],
          "title": "Uptime",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 1,
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                }
              ],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "rgba(50, 172, 45, 0.97)",
                    "value": 0
                  },
                  {
                    "color": "rgba(237, 129, 40, 0.89)",
                    "value": 70
                  },
                  {
                    "color": "rgba(245, 54, 54, 0.9)",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 5,
            "x": 6,
            "y": 1
          },
          "id": 58,
          "maxDataPoints": 100,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "sum(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"heap\"})*100/sum(jvm_memory_max_bytes{service_name=\"$service_name\", env=\"$env\", area=\"heap\"})",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "range": true,
              "refId": "A",
              "step": 14400
            }
          ],
          "title": "Heap Used",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "decimals": 1,
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                },
                {
                  "options": {
                    "from": -1e+32,
                    "result": {
                      "text": "N/A"
                    },
                    "to": 0
                  },
                  "type": "range"
                }
              ],
              "max": 100,
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "rgba(50, 172, 45, 0.97)",
                    "value": 0
                  },
                  {
                    "color": "rgba(237, 129, 40, 0.89)",
                    "value": 70
                  },
                  {
                    "color": "rgba(245, 54, 54, 0.9)",
                    "value": 90
                  }
                ]
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 5,
            "x": 11,
            "y": 1
          },
          "id": 60,
          "maxDataPoints": 100,
          "options": {
            "minVizHeight": 75,
            "minVizWidth": 75,
            "orientation": "horizontal",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showThresholdLabels": false,
            "showThresholdMarkers": true,
            "sizing": "auto"
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "sum(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"nonheap\"})*100/sum(jvm_memory_max_bytes{service_name=\"$service_name\", env=\"$env\", area=\"nonheap\"})",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "",
              "range": true,
              "refId": "A",
              "step": 14400
            }
          ],
          "title": "Non-Heap Used",
          "type": "gauge"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 1
          },
          "id": 66,
          "options": {
            "alertThreshold": true,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "process_files_open{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Open Files",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Process Open Files",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "dateTimeAsIso"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 3,
            "w": 6,
            "x": 0,
            "y": 4
          },
          "id": 56,
          "maxDataPoints": 100,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "process_start_time_milliseconds{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 2,
              "legendFormat": "",
              "metric": "",
              "range": true,
              "refId": "A",
              "step": 14400
            }
          ],
          "title": "Start time",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 7
          },
          "id": 95,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "system_cpu_usage{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "System CPU Usage",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "process_cpu_usage{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Process CPU Usage",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "CPU Usage",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 7
          },
          "id": 96,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "system_load_average_1m{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Load Average [1m]",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "system_cpu_count{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "CPU Core Size",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Load Average",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 14
          },
          "id": 48,
          "panels": [],
          "title": "JVM Statistics - Memory",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 15
          },
          "id": 85,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "repeat": "memory_pool_heap",
          "repeatDirection": "h",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Used",
              "range": true,
              "refId": "C"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_committed_bytes{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Commited",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_max_bytes{service_name=\"$service_name\", env=\"$env\", id=\"$memory_pool_heap\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Max",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "$memory_pool_heap (heap)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 23
          },
          "id": 88,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "repeat": "memory_pool_nonheap",
          "repeatDirection": "h",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", id=\"${memory_pool_nonheap:raw}\"}",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "Used",
              "range": true,
              "refId": "C"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_committed_bytes{service_name=\"$service_name\", env=\"$env\", id=\"${memory_pool_nonheap:raw}\"}",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "Commited",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_memory_max_bytes{service_name=\"$service_name\", env=\"$env\", id=\"${memory_pool_nonheap:raw}\"}",
              "format": "time_series",
              "hide": false,
              "intervalFactor": 1,
              "legendFormat": "Max",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "$memory_pool_nonheap (non-heap)",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 39
          },
          "id": 82,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_buffer_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", id=\"direct\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Used Bytes",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_buffer_total_capacity_bytes{service_name=\"$service_name\", env=\"$env\", id=\"direct\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Capacity Bytes",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Direct Buffers",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 39
          },
          "id": 68,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_threads_daemon{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Daemon",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_threads_live{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Live",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_threads_peak{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Peak",
              "range": true,
              "refId": "C"
            }
          ],
          "title": "Threads",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 46
          },
          "id": 78,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(jvm_gc_memory_allocated_bytes_total{service_name=\"$service_name\", env=\"$env\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "allocated",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(jvm_gc_memory_promoted_bytes_total{service_name=\"$service_name\", env=\"$env\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "promoted",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Memory Allocate/Promote",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 47
          },
          "id": 83,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_buffer_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", id=\"mapped\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Used Bytes",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "jvm_buffer_total_capacity_bytes{service_name=\"$service_name\", env=\"$env\", id=\"mapped\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Capacity Bytes",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Mapped Buffers",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 54
          },
          "id": 72,
          "panels": [],
          "title": "JVM Statistics - GC",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 0,
            "y": 55
          },
          "id": 74,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(jvm_gc_pause_milliseconds_count{service_name=\"$service_name\", env=\"$env\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{action}} [{{cause}}]",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GC Count",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 10,
            "w": 12,
            "x": 12,
            "y": 55
          },
          "id": 76,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(jvm_gc_pause_milliseconds_sum{service_name=\"$service_name\", env=\"$env\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{action}} [{{cause}}]",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "GC Stop the World Duration",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 65
          },
          "id": 34,
          "panels": [],
          "title": "Database Connection Pool HikariCP  Statistics",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 66
          },
          "id": 44,
          "maxDataPoints": 100,
          "options": {
            "colorMode": "none",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connections Size",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "normal"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 8,
            "w": 20,
            "x": 4,
            "y": 66
          },
          "id": 36,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_active{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Active",
              "range": true,
              "refId": "B"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_idle{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Idle",
              "range": true,
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_pending{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Pending",
              "range": true,
              "refId": "C"
            }
          ],
          "title": "Connections",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "thresholds"
              },
              "mappings": [
                {
                  "options": {
                    "match": "null",
                    "result": {
                      "text": "N/A"
                    }
                  },
                  "type": "special"
                }
              ],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 4,
            "w": 4,
            "x": 0,
            "y": 70
          },
          "id": 46,
          "maxDataPoints": 100,
          "options": {
            "colorMode": "none",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "percentChangeColorMode": "standard",
            "reduceOptions": {
              "calcs": [
                "lastNotNull"
              ],
              "fields": "",
              "values": false
            },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_timeout_total{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connection Timeout Count",
          "type": "stat"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 0,
            "y": 74
          },
          "id": 38,
          "options": {
            "alertThreshold": true,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_creation_milliseconds_sum{service_name=\"$service_name\", env=\"$env\"} / hikaricp_connections_creation_milliseconds_count{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Creation Time",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connection Creation Time",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 8,
            "y": 74
          },
          "id": 42,
          "options": {
            "alertThreshold": true,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_usage_milliseconds_sum{service_name=\"$service_name\", env=\"$env\"} / hikaricp_connections_usage_milliseconds_count{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Usage Time",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connection Usage Time",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 0,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "auto",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": {
            "h": 6,
            "w": 8,
            "x": 16,
            "y": 74
          },
          "id": 40,
          "options": {
            "alertThreshold": true,
            "legend": {
              "calcs": [],
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "single",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "hikaricp_connections_acquire_milliseconds_sum{service_name=\"$service_name\", env=\"$env\"} / hikaricp_connections_acquire_milliseconds_count{service_name=\"$service_name\", env=\"$env\"}",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "Acquire Time",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connection Acquire Time",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 80
          },
          "id": 18,
          "panels": [],
          "title": "HTTP Statistics",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 81
          },
          "id": 4,
          "options": {
            "legend": {
              "calcs": [],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "irate(http_server_requests_milliseconds_count{service_name=\"$service_name\", env=\"$env\", uri!~\".*(prometheus|health).*\"}[5m])",
              "instant": false,
              "legendFormat": "__auto",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Request Count",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 24,
            "x": 0,
            "y": 88
          },
          "id": 2,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "max",
                "min"
              ],
              "displayMode": "table",
              "placement": "right",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "irate(http_server_requests_milliseconds_sum{service_name=\"$service_name\", env=\"$env\", exception=\"none\", uri!~\".*(prometheus|health).*\"}[5m]) / irate(http_server_requests_milliseconds_count{service_name=\"$service_name\", env=\"$env\", exception=\"none\",uri!~\".*(prometheus|health).*\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "{{method}} [{{status}}] - {{uri}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Response Time",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": {
            "h": 1,
            "w": 24,
            "x": 0,
            "y": 95
          },
          "id": 8,
          "panels": [],
          "title": "Logback Statistics",
          "type": "row"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 0,
            "y": 96
          },
          "id": 6,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "alias": "",
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(logback_events_total{service_name=\"$service_name\", env=\"$env\", level=\"info\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "info",
              "range": true,
              "rawSql": "SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",
              "refId": "A"
            },
            {
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "logback_events_total{service_name=\"$service_name\", env=\"$env\"}",
              "hide": true,
              "legendFormat": "__auto",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "INFO logs",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 12,
            "x": 12,
            "y": 96
          },
          "id": 10,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "alias": "",
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(logback_events_total{service_name=\"$service_name\", env=\"$env\", level=\"error\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "error",
              "range": true,
              "rawSql": "SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",
              "refId": "A"
            }
          ],
          "title": "ERROR logs",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 0,
            "y": 103
          },
          "id": 14,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "alias": "",
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(logback_events_total{service_name=\"$service_name\", env=\"$env\", level=\"warn\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "warn",
              "range": true,
              "rawSql": "SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",
              "refId": "A"
            }
          ],
          "title": "WARN logs",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 8,
            "y": 103
          },
          "id": 16,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "alias": "",
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(logback_events_total{service_name=\"$service_name\", env=\"$env\", level=\"debug\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "debug",
              "range": true,
              "rawSql": "SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",
              "refId": "A"
            }
          ],
          "title": "DEBUG logs",
          "type": "timeseries"
        },
        {
          "datasource": {
            "type": "prometheus",
            "uid": "mimir-ds"
          },
          "fieldConfig": {
            "defaults": {
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "barAlignment": 0,
                "barWidthFactor": 0.6,
                "drawStyle": "line",
                "fillOpacity": 10,
                "gradientMode": "none",
                "hideFrom": {
                  "legend": false,
                  "tooltip": false,
                  "viz": false
                },
                "insertNulls": false,
                "lineInterpolation": "linear",
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": {
                  "type": "linear"
                },
                "showPoints": "never",
                "showValues": false,
                "spanNulls": false,
                "stacking": {
                  "group": "A",
                  "mode": "none"
                },
                "thresholdsStyle": {
                  "mode": "off"
                }
              },
              "mappings": [],
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "color": "green",
                    "value": 0
                  },
                  {
                    "color": "red",
                    "value": 80
                  }
                ]
              },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": {
            "h": 7,
            "w": 8,
            "x": 16,
            "y": 103
          },
          "id": 20,
          "options": {
            "legend": {
              "calcs": [
                "mean",
                "lastNotNull",
                "max",
                "min",
                "sum"
              ],
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": true
            },
            "tooltip": {
              "hideZeros": false,
              "mode": "multi",
              "sort": "none"
            }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "alias": "",
              "datasource": {
                "type": "prometheus",
                "uid": "mimir-ds"
              },
              "editorMode": "code",
              "expr": "rate(logback_events_total{service_name=\"$service_name\", env=\"$env\", level=\"trace\"}[5m])",
              "format": "time_series",
              "intervalFactor": 1,
              "legendFormat": "trace",
              "range": true,
              "rawSql": "SELECT\n  $__time(time_column),\n  value1\nFROM\n  metric_table\nWHERE\n  $__timeFilter(time_column)\n",
              "refId": "A"
            }
          ],
          "title": "TRACE logs",
          "type": "timeseries"
        }
      ],
      "preload": false,
      "refresh": "",
      "schemaVersion": 42,
      "tags": [
        "app"
      ],
      "templating": {
        "list": [
          {
            "current": {
              "text": "",
              "value": ""
            },
            "datasource": {
              "type": "prometheus",
              "uid": "mimir-ds"
            },
            "definition": "label_values(jvm_memory_used_bytes, service_name)",
            "label": "ServiceName",
            "name": "service_name",
            "options": [],
            "query": {
              "qryType": 1,
              "query": "label_values(jvm_memory_used_bytes, service_name)",
              "refId": "PrometheusVariableQueryEditor-VariableQuery"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": {
              "text": "",
              "value": ""
            },
            "datasource": {
              "type": "prometheus",
              "uid": "mimir-ds"
            },
            "definition": "label_values(jvm_memory_used_bytes, env)",
            "label": "env",
            "name": "env",
            "options": [],
            "query": {
              "qryType": 1,
              "query": "label_values(jvm_memory_used_bytes, env)",
              "refId": "PrometheusVariableQueryEditor-VariableQuery"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "type": "prometheus",
              "uid": "mimir-ds"
            },
            "definition": "label_values(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"heap\"},id)",
            "includeAll": true,
            "label": "Memory Pool (heap)",
            "name": "memory_pool_heap",
            "options": [],
            "query": {
              "query": "label_values(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"heap\"},id)",
              "refId": "PrometheusVariableQueryEditor-VariableQuery"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": {
              "text": "All",
              "value": "$__all"
            },
            "datasource": {
              "type": "prometheus",
              "uid": "mimir-ds"
            },
            "definition": "label_values(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"nonheap\"},id)",
            "includeAll": true,
            "label": "Memory Pool (nonheap)",
            "name": "memory_pool_nonheap",
            "options": [],
            "query": {
              "query": "label_values(jvm_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", area=\"nonheap\"},id)",
              "refId": "PrometheusVariableQueryEditor-VariableQuery"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          }
        ]
      },
      "time": {
        "from": "now-1h",
        "to": "now"
      },
      "timepicker": {},
      "timezone": "",
      "title": "Spring Boot 3.x LSM Template",
      "uid": "spring_boot_21",
      "version": 1,
      "weekStart": "monday"
    }
  kafka_local.json: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": { "type": "datasource", "uid": "grafana" },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" },
            "type": "dashboard"
          }
        ]
      },
      "description": "Kafka dashboard (Local) based on JMX Prometheus Javaagent metrics + (optional) kafka_exporter for consumer lag. Requires Prometheus labels: service_name/env (recommended).",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "id": 1,
          "panels": [],
          "title": "Kafka - Broker Health",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" }
              ],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": 0 }, { "color": "green", "value": 1 }] }
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 0, "y": 1 },
          "id": 2,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "up{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Target Up",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "gridPos": { "h": 3, "w": 6, "x": 6, "y": 1 },
          "id": 3,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_active_controller{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Active Controller",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "gridPos": { "h": 3, "w": 6, "x": 12, "y": 1 },
          "id": 4,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_under_replicated_partitions{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Under Replicated Partitions",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "max": 100,
              "min": 0,
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  { "color": "rgba(245, 54, 54, 0.9)", "value": 0 },
                  { "color": "rgba(237, 129, 40, 0.89)", "value": 20 },
                  { "color": "rgba(50, 172, 45, 0.97)", "value": 50 }
                ]
              }
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 18, "y": 1 },
          "id": 5,
          "options": {
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showThresholdLabels": false,
            "showThresholdMarkers": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_network_processor_avg_idle_percent{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"} * 100",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Network Processor Avg Idle (%)",
          "type": "gauge"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "percent"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 0, "y": 4 },
          "id": 6,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["lastNotNull", "min"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_network_processor_idle_percent{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"} * 100",
              "legendFormat": "np={{network_processor}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Network Processor Idle (%) by Processor",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "Bps"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 12, "y": 4 },
          "id": 7,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_broker_bytesinpersec_rate_1m{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "bytes_in/s (1m)",
              "range": true,
              "refId": "A"
            },
            {
              "editorMode": "code",
              "expr": "kafka_broker_bytesoutpersec_rate_1m{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "bytes_out/s (1m)",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Broker Throughput (Bytes In/Out) - 1m rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 11 },
          "id": 10,
          "panels": [],
          "title": "Kafka - Requests / Errors",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 0, "y": 12 },
          "id": 11,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (request) (kafka_request_errors_rate_1m{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\", error!=\"NONE\"})",
              "legendFormat": "{{request}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Request Errors Rate (exclude NONE)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 12, "y": 12 },
          "id": 12,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_broker_messagesinpersec_rate_1m{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "messages/s (1m)",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Messages In - 1m rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 19 },
          "id": 20,
          "panels": [],
          "title": "Kafka - Topic",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "Bps"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 24, "x": 0, "y": 20 },
          "id": 21,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "kafka_topic_bytesinpersec_rate_1m{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\", topic=~\"$topic\"}",
              "legendFormat": "{{topic}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Topic Bytes In - 1m rate",
          "type": "timeseries"
        },
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 27 },
          "id": 30,
          "panels": [],
          "title": "Kafka - Consumer Lag (kafka_exporter)",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "short"
            },
            "overrides": []
          },
          "gridPos": { "h": 8, "w": 24, "x": 0, "y": 28 },
          "id": 31,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "sum by (consumergroup) (kafka_consumergroup_lag{service_name=\"$service_name\", env=\"$env\", consumergroup=~\"$consumergroup\"})",
              "legendFormat": "{{consumergroup}}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Consumer Group Lag (sum)",
          "type": "timeseries"
        }
      ],
      "preload": false,
      "refresh": "",
      "schemaVersion": 42,
      "tags": ["kafka", "local"],
      "templating": {
        "list": [
          {
            "current": { "text": "kafka", "value": "kafka" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up, service_name)",
            "label": "ServiceName",
            "name": "service_name",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up, service_name)", "refId": "var-service" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "local", "value": "local" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up, env)",
            "label": "env",
            "name": "env",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up, env)", "refId": "var-env" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "All", "value": "$__all" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up{service_name=\"$service_name\", env=\"$env\"}, instance)",
            "includeAll": true,
            "label": "instance",
            "multi": true,
            "name": "instance",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up{service_name=\"$service_name\", env=\"$env\"}, instance)", "refId": "var-instance" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "All", "value": "$__all" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values({__name__=~\"kafka_topic_.*\", service_name=\"$service_name\", env=\"$env\"}, topic)",
            "includeAll": true,
            "label": "topic",
            "multi": true,
            "name": "topic",
            "options": [],
            "query": {
              "qryType": 1,
              "query": "label_values({__name__=~\"kafka_topic_.*\", service_name=\"$service_name\", env=\"$env\"}, topic)",
              "refId": "var-topic"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "All", "value": "$__all" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(kafka_consumergroup_lag{service_name=\"$service_name\", env=\"$env\"}, consumergroup)",
            "includeAll": true,
            "label": "consumer_group",
            "multi": true,
            "name": "consumergroup",
            "options": [],
            "query": {
              "qryType": 1,
              "query": "label_values(kafka_consumergroup_lag{service_name=\"$service_name\", env=\"$env\"}, consumergroup)",
              "refId": "var-cg"
            },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          }
        ]
      },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "",
      "title": "Kafka (Local) - Broker / Topic / Consumer Lag",
      "uid": "kafka_local",
      "version": 1,
      "weekStart": "monday"
    }
  redis_exporter_local.yaml: |
    {
      "annotations": {
        "list": [
          {
            "builtIn": 1,
            "datasource": { "type": "datasource", "uid": "grafana" },
            "enable": true,
            "hide": true,
            "iconColor": "rgba(0, 211, 255, 1)",
            "name": "Annotations & Alerts",
            "target": { "limit": 100, "matchAny": false, "tags": [], "type": "dashboard" },
            "type": "dashboard"
          }
        ]
      },
      "description": "Redis Exporter dashboard (Local). Requires Prometheus labels: service_name/env (recommended).",
      "editable": true,
      "fiscalYearStartMonth": 0,
      "graphTooltip": 0,
      "id": null,
      "links": [],
      "panels": [
        {
          "collapsed": false,
          "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
          "id": 1,
          "panels": [],
          "title": "Redis - Overview",
          "type": "row"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" }
              ],
              "thresholds": { "mode": "absolute", "steps": [{ "color": "red", "value": 0 }, { "color": "green", "value": 1 }] },
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 0, "y": 1 },
          "id": 2,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "up{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Target Up",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" }
              ],
              "unit": "s"
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 6, "y": 1 },
          "id": 3,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_uptime_in_seconds{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Redis Uptime",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" }
              ],
              "unit": "none"
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 12, "y": 1 },
          "id": 4,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_connected_clients{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connected Clients",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "mappings": [
                { "options": { "match": "null", "result": { "text": "N/A" } }, "type": "special" }
              ],
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": { "h": 3, "w": 6, "x": 18, "y": 1 },
          "id": 5,
          "options": {
            "colorMode": "value",
            "graphMode": "none",
            "justifyMode": "auto",
            "orientation": "horizontal",
            "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
            "showPercentChange": false,
            "textMode": "auto",
            "wideLayout": true
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Memory Used",
          "type": "stat"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "bytes"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 0, "y": 4 },
          "id": 6,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["lastNotNull", "max", "min"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_memory_used_bytes{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "used",
              "range": true,
              "refId": "A"
            },
            {
              "editorMode": "code",
              "expr": "redis_memory_used_peak_bytes{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "peak",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Memory (Used / Peak)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 12, "y": 4 },
          "id": 7,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["lastNotNull", "max", "min"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_connected_clients{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "clients",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Connected Clients",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 0, "y": 11 },
          "id": 8,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "rate(redis_commands_processed_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m])",
              "legendFormat": "ops/s",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Ops/sec",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "percentunit"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 12, "y": 11 },
          "id": 9,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "min"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "rate(redis_keyspace_hits_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m]) / (rate(redis_keyspace_hits_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m]) + rate(redis_keyspace_misses_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m]))",
              "legendFormat": "hit_ratio",
              "range": true,
              "refId": "A"
            }
          ],
          "title": "Cache Hit Ratio",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "ops"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 0, "y": 18 },
          "id": 10,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["mean", "lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "rate(redis_evicted_keys_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m])",
              "legendFormat": "evicted/s",
              "range": true,
              "refId": "A"
            },
            {
              "editorMode": "code",
              "expr": "rate(redis_expired_keys_total{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}[5m])",
              "legendFormat": "expired/s",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Evicted / Expired (rate)",
          "type": "timeseries"
        },
        {
          "datasource": { "type": "prometheus", "uid": "mimir-ds" },
          "fieldConfig": {
            "defaults": {
              "color": { "mode": "palette-classic" },
              "custom": {
                "axisBorderShow": false,
                "axisCenteredZero": false,
                "axisColorMode": "text",
                "axisLabel": "",
                "axisPlacement": "auto",
                "drawStyle": "line",
                "fillOpacity": 10,
                "lineWidth": 1,
                "pointSize": 5,
                "scaleDistribution": { "type": "linear" },
                "showPoints": "never",
                "spanNulls": false,
                "stacking": { "group": "A", "mode": "none" }
              },
              "unit": "locale"
            },
            "overrides": []
          },
          "gridPos": { "h": 7, "w": 12, "x": 12, "y": 18 },
          "id": 11,
          "options": {
            "legend": { "displayMode": "table", "placement": "bottom", "showLegend": true, "calcs": ["lastNotNull", "max"] },
            "tooltip": { "mode": "multi", "sort": "none" }
          },
          "pluginVersion": "12.2.0",
          "targets": [
            {
              "editorMode": "code",
              "expr": "redis_db_keys{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "{{db}} keys",
              "range": true,
              "refId": "A"
            },
            {
              "editorMode": "code",
              "expr": "redis_db_keys_expiring{service_name=\"$service_name\", env=\"$env\", instance=~\"$instance\"}",
              "legendFormat": "{{db}} expiring",
              "range": true,
              "refId": "B"
            }
          ],
          "title": "Keyspace (keys / expiring)",
          "type": "timeseries"
        }
      ],
      "preload": false,
      "refresh": "",
      "schemaVersion": 42,
      "tags": ["redis", "local"],
      "templating": {
        "list": [
          {
            "current": { "text": "redis", "value": "redis" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up, service_name)",
            "label": "ServiceName",
            "name": "service_name",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up, service_name)", "refId": "var-service" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "local", "value": "local" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up, env)",
            "label": "env",
            "name": "env",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up, env)", "refId": "var-env" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          },
          {
            "current": { "text": "All", "value": "$__all" },
            "datasource": { "type": "prometheus", "uid": "mimir-ds" },
            "definition": "label_values(up{service_name=\"$service_name\", env=\"$env\"}, instance)",
            "includeAll": true,
            "label": "instance",
            "multi": true,
            "name": "instance",
            "options": [],
            "query": { "qryType": 1, "query": "label_values(up{service_name=\"$service_name\", env=\"$env\"}, instance)", "refId": "var-instance" },
            "refresh": 2,
            "regex": "",
            "sort": 1,
            "type": "query"
          }
        ]
      },
      "time": { "from": "now-1h", "to": "now" },
      "timepicker": {},
      "timezone": "",
      "title": "Redis Exporter (Local)",
      "uid": "redis_exporter_local",
      "version": 1,
      "weekStart": "monday"
    }
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: grafana-data
  namespace: ongi-obs
spec:
  accessModes: ["ReadWriteOnce"]
  resources:
    requests:
      storage: 5Gi
  storageClassName: local-path
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
  namespace: ongi-obs
spec:
  replicas: 1
  selector:
    matchLabels: { app: grafana }
  template:
    metadata:
      labels: { app: grafana }
    spec:
      initContainers:
        - name: init-grafana-dashboards
          image: busybox:1.36
          command:
            - sh
            - -c
            - |
              set -e
              mkdir -p /var/lib/grafana/dashboards
              # ConfigMap에 들어있는 json들을 PVC로 복사 (덮어쓰기)
              cp -f /tmp/dashboards/*.json /var/lib/grafana/dashboards/ 2>/dev/null || true
              echo "[dashboards] copied:"
              ls -al /var/lib/grafana/dashboards || true
          volumeMounts:
            - name: grafana-data
              mountPath: /var/lib/grafana
            - name: grafana-dashboards
              mountPath: /tmp/dashboards
      containers:
        - name: grafana
          image: grafana/grafana:latest
          env:
            - name: GF_SECURITY_ADMIN_USER
              value: "admin"
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: "admin"
          ports:
            - containerPort: 3000
          volumeMounts:
            - name: grafana-data
              mountPath: /var/lib/grafana
            - name: grafana-datasources
              mountPath: /etc/grafana/provisioning/datasources/datasources.yml
              subPath: datasources.yml
            - name: grafana-dashboard-providers
              mountPath: /etc/grafana/provisioning/dashboards/dashboards.yaml
              subPath: dashboards.yaml
          resources:
            requests:
              cpu: "50m"
              memory: "128Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
      volumes:
        - name: grafana-data
          persistentVolumeClaim:
            claimName: grafana-data
        - name: grafana-datasources
          configMap:
            name: grafana-datasources
        - name: grafana-dashboard-providers
          configMap:
            name: grafana-dashboard-providers
        - name: grafana-dashboards
          configMap:
            name: grafana-dashboards
---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: ongi-obs
spec:
  selector: { app: grafana }
  ports:
    - name: http
      port: 3000
      targetPort: 3000